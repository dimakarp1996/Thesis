\chapter{Исследование переноса знаний в многоязычных моделях на новом тематическом наборе данных}\label{ch:rutopics}
\section{Введение}
Обучение модели одновременно решать одну и ту же задачу для разных языков можно рассматривать как подвид многозадачного обучения.

В предыдущей главе~\ref{ch:tr-ag} был исследован перенос знаний в многозадачных моделях. Тем не менее, в этой главе остался не исследован перенос знаний с русского языка на другие языки, не было раскрыто то, от чего зависят характеристики этого переноса. 

В данной главе изучается перенос знаний с русского языками на большое число языков. 


Существующие наборы данных для тематической классификации, поддерживающие русский язык, имеют следующие проблемы:
\begin{itemize}
   \item Часть таких наборов данных состоит из длинных обучающих примеров (как правило -- новостей). Опыт применения моделей, обученных на наборе данных {DeepPavlov Topics} в диалоговой платформе Dream, показывает (см. главу~\ref{ch:mtldream}), что модели, обученные на таких данных, могут переобучаться на них и плохо себя показывать на реальных диалоговых задачах. Примерами таких наборов данных являются {MLSUM}~\cite{mlsum} и {XGLUE-nc}~\cite{xglue}.
   \item Часть таких наборов данных является слишком специфичными и хорошо подходят для классификации узкоспециализированных вопросов, но не подходят для классификации широкого спектра тем из-за специфичной номенклатуры классов.  Примерами таких наборов данных являются~\cite{healthcare_facilities_reviews} и~\cite{pstu}.
   \item Некоторые наборы данных для тематической классификации лишены этих проблем, но либо имеют слишком маленькое число примеров~\cite{chatbotru}, либо имеют номенклатуру классов, далекую от покрытия всех потребностей диалоговой системы~\cite{massive}.
\end{itemize}
Решение данных проблем было подробно освещено в статье \cite{rutopics}, по материалам которой написана данная глава. Данная статья посвящена исследованию многоязычного переноса знаний с полученного набора русскоязычных данных.

\textbf{Задача}, поставленныая в данной главе: \textbf{Проверить зависимость межъязыкового переноса знаний на разговорных данных в многоязычных нейросетевых моделях от размера предобучающей выборки и генеалогической близости языков к языку дообучения.}

Для решения этой задачи автором был составлен набор данных и была проверена степень его пригодности к решению разговорных задач.

В качестве языка дообучения в данной главе использовался только русский язык. Использование других языков в качестве языков дообучения требует дополнительных исследований.

\section{Набор данных {RuQTopics}}

В работе изучается русскоязычный набор данных для тематической классификации -- {RuQTopics}.
\subsection{Получение набора данных}
Этот набор данных с сервиса «Яндекс. Кью»~\cite{yandex_q} был составлен автором из данных, доступных по данной ссылке:\url{https://huggingface.co/datasets/its5Q/yandex-q/blob/main/full.jsonl.gz}.

В данный набор данных были включены примеры из 76 разных тем. Выбор тем осуществлялся, основываясь на наборе данных {DeepPavlov Topics} и потребностях диалоговой платформы \textbf{Dream}. Тема каждого вопроса соответствовала теме этого вопроса из «Яндекс. Кью». Некоторые из выбранных тем могут быть похожими друг на друга, как и реальные темы из «Яндекс. Кью» -- следовательно, прикладное использование набора данных {RuQTopics} может требовать объединения некоторых тем.

 Для каждого вопроса, выбирался также ответ наилучшего качества (или первый из таких ответов, если их было несколько). Для части вопросов ответ был пустым. 
 
% TODO ВЫБОРКА ТЕСТОВАЯ ВАЛИДАЦИОННАЯ ИЛИ РАЗБИЕНИЕ? singlelabel multilabel перевод) однометочная? многометочная? Формат чисел. {Dream} -- жирным

% TODO. CHECK THE TOPIC NUMBER. PROVIDE a LINK TO EVERY QUESTION in the final dataset version. 
\subsection{Разбиение и размеры}
Полученные пары вопрос-ответ были разбиты на две части. В часть 1 (однометочную) попали только те пары, в которых вопрос принадлежит только к одной теме, и при этом ответ на этот вопрос либо не существует, либо может быть найден только в этой же теме. Все остальные примеры принадлежат части 2 (многометочной). Все эксперименты, описанные в данной главе, проводились только с примерами из однометочной части {RuQTopics}.


Для всех тем, было выбрано 532590 уникальных вопросов, из которых 403938 было отвечено. При этом однометочная часть набора данных содержит 361650 вопросов, из которых 266597 было отвечено. Многометочная часть, в свою очередь, содержит 170930 вопросов, из которых 137431 было отвечено.
%todo -- RuQTopics одними и теми же буквами как в статтк

Помимо этого, из однометочной части {RuQTopics} была дополнительно выделена равноразмерная часть данного набора данных. Если вопрос отвечен и суммаризованная версия вопроса при этом встречается только в одной теме (той же, что и тема ответа), то данный вопрос вместе с ответом и суммаризованным ответом включается не только в однометочную часть {RuQTopics}, но и в равноразмерную часть этого набора данных.
 
Размеры всех частей {RuQTopics} как для всего набора данных, так и для каждого из классов, с которыми проводились описанные в данной главе эксперименты, включены в Таблицу~\ref{tab:rutopics:sizes}.

%TODO
\begin{table*}
\centering
\scalebox{0.7}{
\begin{tabular}{|c||c|c|c|c|c|} \hline
\textbf{тип данных}  & \multicolumn{2}{c|}{\textbf{однометочные}} & \multicolumn{2}{c|}{\textbf{многометочные}} & \multirow{2}{*}{\textbf{равноразмерные}}\\
\cline{1-5}
\textbf{класс}  & \multicolumn{1}{c|}{все} & \multicolumn{1}{c|}{отвеченные} & \multicolumn{1}{c|}{все} & \multicolumn{1}{c|}{отвеченные} & \\\hline \hline
\textit{Размер набора данных} & 361650 & 266597 & 170930 & 137341 & 264786\\ \hline
\textit{Размер 6классового поднабора данных} & 18864 & 15912 & 27191 & 20569 & 15830 \\ \hline
\textit{Музыка} & 9514 & 5809 & 4456 & 3287 & 5797 \\ \hline
\textit{Еда, напитки и кулинария} & 5750 & 4758 & 14096 & 11084 & 4723 \\ \hline
\textit{Медиа и коммуникации} & 4505 & 2637 & 5577 & 3948 & 2619 \\ \hline
\textit{Транспорт} & 2435 & 1625 & 1933 & 1387 & 1613 \\ \hline
\textit{Новости} & 945 & 602 & 912 & 720 & 600\\ \hline
\textit{Погода} & 890 & 481 & 217 & 143 & 478 \\ \hline
\end{tabular}
}
\caption{Размеры набора данных {RuQTopics} по классу и части}
%\centering
\label{tab:rutopics:sizes}
\end{table*}


\section{Выбор представления набора данных {RuQTopics}}\label{rutopics:prepr}

После получения набора данных {RuQTopics}, было необходимо выбрать метод предобработки данного набора данных, показывающий наилучшие результаты на разговорных задачах. Проводилось сравнение следующих трех методов предобработки:

\begin{itemize}
   \item \textbf{Q} означает использование только вопросов.
   \item \textbf{A} означает использование только ответов.
   \item \textbf{Q [SEP] A} означает, что если ответ на вопрос существует, используется конкатенация вопроса с ответом на этот вопрос при помощи токена [SEP]. Иначе используется просто вопрос.  
\end{itemize}

В предварительных экспериментах, вместо ответов использовались их суммаризованные версии. Суммаризация проводилась при помощи алгоритма TextRank~\cite{summarizer}. Использование только суммаризованных ответов показало стабильно худшие результаты, чем использование только несуммаризованных. При этом конкатенация вопросов к суммаризованным ответам не дает устойчивых изменений качества по сравнению с конкатенацией вопросов к ответам.

Для всех методов предобработки, обучение проводилось на равноразмерной версии {RuQTopics} (колонка «равноразмерные» из Таблицы~\ref{tab:rutopics:sizes}).
Такой режим обучения позволяет проводить честное сравнение между признаками, полученными разными методами предобработки, так как количество тренировочных примеров при данном режиме то же самое безотносительно способа предобработки данных. Результаты сравнения вышеупомянутых методов предобработки приводятся в Таблице~\ref{tab:rutopics:matched}. В этой таблице и всех таблицах этого раздела макро-F1 обозначается как F1.
 \subsection{Как сравнить представления набора данных друг с другом?}
Для оценки любого из упомянутых выше методов предобработки набора данных, модель для сравнения обучалась на тренировочных примерах из {RuQTopics}, принадлежащих любому из соответствующих набору данных {MASSIVE} шести классов и полученных в соответствии с этим методом. Валидация производилась на примерах из валидационной части MASSIVE, принадлежащих вышеупомянутым шести классам. После завершения обучения, данная модель оценивалась на поднаборе тренировочных+тестовых примеров из русского {MASSIVE}, принадлежащих соответствующим шести классам из этого набора данных. Этот поднабор обозначается как «объединенные тестовые данные».

При сравнении набора данных {RuQTopics} с набором данных {MASSIVE}, можно видеть, что только шесть классов из {MASSIVE} можно поставить в соответствие классам из  {RuQTopics}. Следовательно, нейросетевая модель в данных экспериментах обучалась только для шести соответствующих классов {RuQTopics}: \textit{Еда, напитки и кулинария} (соответствует классу \textit{cooking} из {MASSIVE}), \textit{Новости} (соответствует классу \textit{news} из {MASSIVE} ), \textit{Транспорт} (соответствует классу \textit{transport} из {MASSIVE}), \textit{Музыка} (соответствует классу \textit{music} из {MASSIVE}),\textit{Медиа и коммуникации} (соответствует классу \textit{social} из {MASSIVE}) и \textit{Погода} (соответствует классу \textit{weather} из {MASSIVE} class). Классы из набора данных {RuQTopics} никак не объединялись, хотя это предположительно могло бы дополнительно улучшить результаты на классах \textit{cooking} и \textit{transport} из набора данных {MASSIVE}.

Этот метод позволяет проверить пригодность набора данных {RuQTopics} для разговорной тематической классификации -- по крайней мере, на выбранных шести классах. Впрочем, так как примеры для всех шести классов были получены похожим образом, можно ожидать, что другие классы из {RuQTopics} настолько же хорошо подходят для разговорной тематической классификации.

\subsection{Описание экспериментов для сравнения}
Эксперименты, описанные в Таблице~\ref{tab:rutopics:matched}, проводились на различных базовых моделях из библиотеки {Transformers}~\cite{huggingface_transformers} от HuggingFace : \textit{bert-base-multilingual-cased}~\cite{multilingual_bert}, \textit{DeepPavlov/distilrubert-tiny-cased-conversational}~\cite{distilrubert}, \textit{sberbank-ai/ruBert-base}~\cite{sbert_base}  \textit{DeepPavlov/rubert-base-conversational-cased}~\cite{rubert}. Все эти модели имеют архитектуру типа BERT. Последние 2 модели очень похожи, но имеют несколько отличающееся число параметров, так как в них применяются разные методы токенизации.

Данные всех экспериментов, описанных в этой главе, приведены в Приложении~\ref{appendix:rutopics:allruns}. 

Подробное сравнение всех базовых моделей приведено в Таблице~\ref{tab:rutopics:backbones}.

\begin{table*}
\centering
\resizebox{\textwidth}{!}{
\begin{tabular}{|c|c|c|c|c|}
\hline
\multirow{1}{*}{\textbf{Модель}} & \multirow{1}{*}{\textbf{Сокращение}}  & \textbf{Многоязычность} &  \multicolumn{1}{c|}{\textbf{Число слоев}} & \textbf{Parameters}\\ \hline
\textit{DeepPavlov/distilrubert-tiny-cased-conversational}~\cite{distilrubert} & \textit{rubert-tiny} & нет & 2 & 107M\\ \hline
\textit{DeepPavlov/rubert-base-cased-conversational}~\cite{rubert} & \textit{rubert} & нет & 12 & 177.9M\\ \hline
\textit{bert-base-multilingual-cased}~\cite{multilingual_bert} & \textit{multbert} & да & 12 & 177.9M \\ \hline
\textit{sberbank-ai/ruBert-base}~\cite{sbert_base} & \textit{ru-sbert} & да & 12 & 178.3M\\ \hline
\end{tabular}
}
\caption{Параметры различных базовых моделей, рассмотренных в этой главе}
\label{tab:rutopics:backbones}
\end{table*}

\begin{table*}
\centering
\caption{Метрики различных типов базовых моделей на объединенных тестовых данных {MASSIVE} для русского языка.
Модели были обучены на шестиклассовой \textbf{равноразмерной} подвыборке {RuQTopics}, предобработанной при помощи одного из нескольких режимов, описанных в Разделе~\ref{rutopics:prepr}. Условные обозначения моделей -- как в  Таблице~\ref{tab:rutopics:backbones}. Точн. означает точность. Усреднено по трем запускам.}
\scalebox{0.65}{
\label{tab:rutopics:matched}
\begin{tabular}{|c|c||c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
\multirow{2}{*}{\textbf{Модель}} & \multirow{2}{*}{\textbf{Режим}}  &  \multicolumn{2}{c|}{\textbf{Все классы}} &  \multicolumn{2}{c|}{\textbf{music}} &  \multicolumn{2}{c|}{\textbf{cooking}} &  \multicolumn{2}{c|}{\textbf{news}} &  \multicolumn{2}{c|}{\textbf{transport}} &  \multicolumn{2}{c|}{\textbf{weather}} &  \multicolumn{2}{c|}{\textbf{social}} \\ 
\cline{3-16}
& & Точн. & Макро-F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 \\ \hline
\textit{ru} &  \textbf{Q} & 84.2 & 83.4 & 94.3 & 87.5 & 99.0 & 82.0 & 80.1 & 83.1 & 92.3 & 90.7 & 81.3 & 89.0 & 65.5 & 68.1\\ %\hline
\textit{rutiny} &  \textbf{Q} & 85.7 & 84.9 & 94.3 & 89.1 & 99.2 & 81.5 & 76.8 & 83.3 & 93.8 & 92.4 & 84.2 & 90.4 & 73.2 & 72.7\\ %\hline
\textit{rusber} &  \textbf{Q} & 85.2 & 84.1 & 93.9 & 90.2 & 98.9 & 79.8 & 80.3 & 84.3 & 92.8 & 90.6 & 85.7 & 90.9 & 64.9 & 69.0\\ %\hline
\textit{mult} &  \textbf{Q} & 79.1 & 77.7 & 93.2 & 79.8 & 98.0 & 74.0 & 73.5 & 80.3 & 89.9 & 87.9 & 74.4 & 83.9 & 55.2 & 60.1\\ \hline
\textit{ru} &  \textbf{A} & 80.7 & 79.1 & 95.8 & 78.5 & 98.2 & 81.6 & 66.3 & 77.2 & 91.5 & 87.9 & 87.1 & 91.1 & 51.6 & 58.3\\ %\hline
\textit{rutiny} &  \textbf{A} & 82.4 & 81.0 & 96.4 & 81.1 & 99.3 & 78.1 & 71.3 & 80.8 & 88.9 & 90.3 & 86.7 & 90.8 & 60.0 & 64.8\\ %\hline
\textit{rusber} &  \textbf{A} & 82.3 & 80.7 & 94.9 & 81.2 & 98.9 & 80.6 & 72.6 & 80.8 & 89.8 & 89.2 & 88.7 & 91.2 & 54.5 & 61.3\\ %\hline
\textit{mult} &  \textbf{A} & 76.8 & 75.3 & 94.3 & 76.6 & 96.1 & 70.0 & 68.3 & 77.5 & 83.0 & 83.4 & 78.6 & 85.2 & 50.8 & 59.0\\ \hline
\textit{ru} &  \textbf{Q [SEP] A} & 85.7 & 85.2 & 92.3 & 90.1 & 97.4 & 86.4 & 79.1 & 82.9 & 93.3 & 91.5 & 86.4 & 91.1 & 70.3 & 69.5\\ %\hline
\textit{rutiny} &  \textbf{Q [SEP] A} & 85.0 & 84.2 & 95.3 & 87.2 & 98.3 & 82.4 & 75.5 & 82.3 & 89.7 & 92.0 & 86.4 & 91.1 & 72.4 & 70.5\\ %\hline
\textit{rusber} &  \textbf{Q [SEP] A} & 85.3 & 84.7 & 92.7 & 89.5 & 98.7 & 85.8 & 80.7 & 82.1 & 91.0 & 91.1 & 87.1 & 92.0 & 66.7 & 67.9\\ %\hline
\textit{mult} &  \textbf{Q [SEP] A} & 78.5 & 77.6 & 93.0 & 82.5 & 95.9 & 72.9 & 67.0 & 77.1 & 86.1 & 85.6 & 75.1 & 84.0 & 65.1 & 63.5\\ \hline
\end{tabular}
}
\end{table*}

\begin{table*}
\centering
\caption{Метрики различных типов базовых моделей на объединенных тестовых данных {MASSIVE} для русского языка.
Модели были обучены на шестиклассовой \textbf{полной} подвыборке {RuQTopics} (из всей однометочной части), предобработанной при помощи одного из нескольких режимов, описанных в Разделе~\ref{rutopics:prepr}. Условные обозначения моделей -- как в  Таблице~\ref{tab:rutopics:backbones}. Точн. означает точность. Усреднено по трем запускам.}
\scalebox{0.65}{
\label{tab:rutopics:full}
\begin{tabular}{|c|c||c|c|c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
\multirow{2}{*}{\textbf{Модель}} & \multirow{2}{*}{\textbf{Режим}}  &  \multicolumn{2}{c|}{\textbf{Все классы}} &  \multicolumn{2}{c|}{\textbf{music}} &  \multicolumn{2}{c|}{\textbf{cooking}} &  \multicolumn{2}{c|}{\textbf{news}} &  \multicolumn{2}{c|}{\textbf{transport}} &  \multicolumn{2}{c|}{\textbf{weather}} &  \multicolumn{2}{c|}{\textbf{social}} \\ 
\cline{3-16}
& & Точн. & Макро-F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 \\ \hline
\textit{ru} &  \textbf{Q} & 85.0 & 84.3 & 94.7 & 87.5 & 98.4 & 86.0 & 82.5 & 82.7 & 92.1 & 92.1 & 82.5 & 89.6 & 66.1 & 68.0\\ %\hline
\textit{rutiny} &  \textbf{Q} & 85.7 & 85.2 & 95.0 & 87.5 & 98.7 & 87.3 & 82.2 & 82.9 & 92.8 & 92.3 & 84.3 & 90.6 & 67.3 & 70.3\\ %\hline
\textit{rusber} &  \textbf{Q} & 85.5 & 84.9 & 93.7 & 89.9 & 98.8 & 87.2 & 83.0 & 83.1 & 93.1 & 91.1 & 85.1 & 91.1 & 64.3 & 67.2\\ %\hline
\textit{mult} &  \textbf{Q} & 80.8 & 79.8 & 94.3 & 77.3 & 97.2 & 82.8 & 75.5 & 81.1 & 90.0 & 90.5 & 78.5 & 86.0 & 57.5 & 61.0\\ \hline
\textit{ru} &  \textbf{A} & 79.8 & 77.9 & 95.8 & 79.0 & 98.9 & 75.2 & 65.9 & 76.7 & 90.2 & 88.3 & 85.0 & 90.3 & 51.0 & 57.8\\ %\hline
\textit{rutiny} &  \textbf{A} & 82.4 & 80.9 & 96.1 & 81.8 & 99.3 & 78.2 & 72.8 & 81.2 & 88.6 & 89.8 & 87.2 & 91.2 & 57.9 & 63.3\\ %\hline
\textit{rusber} &  \textbf{A} & 82.6 & 80.9 & 94.3 & 83.4 & 98.9 & 80.8 & 74.4 & 80.2 & 90.6 & 89.4 & 89.3 & 90.9 & 52.7 & 60.6\\ %\hline
\textit{mult} &  \textbf{A} & 74.5 & 72.9 & 95.8 & 69.6 & 95.9 & 72.1 & 66.1 & 75.5 & 80.4 & 83.3 & 76.7 & 83.4 & 44.0 & 53.6\\ \hline
\textit{ru} &  \textbf{Q [SEP] A} & 85.4 & 84.9 & 94.0 & 88.5 & 97.6 & 87.1 & 82.5 & 83.7 & 93.1 & 91.5 & 83.6 & 90.0 & 67.1 & 68.8\\ %\hline
\textit{rutiny} &  \textbf{Q [SEP] A} & 85.3 & 84.7 & 94.3 & 87.4 & 97.9 & 86.4 & 79.3 & 81.4 & 91.6 & 92.8 & 86.0 & 91.0 & 68.2 & 69.1\\ %\hline
\textit{rusber} &  \textbf{Q [SEP] A} & 85.1 & 84.2 & 93.1 & 91.6 & 98.3 & 88.4 & 88.1 & 81.2 & 93.3 & 91.9 & 86.2 & 91.6 & 53.7 & 60.7\\ %\hline
\textit{mult} &  \textbf{Q [SEP] A} & 80.0 & 79.7 & 94.2 & 77.0 & 95.1 & 85.5 & 74.9 & 80.3 & 87.8 & 88.0 & 73.8 & 83.8 & 64.6 & 63.6\\ \hline
\end{tabular}
}
\end{table*}

Как можно видеть из Таблицы~\ref{tab:rutopics:matched}, модели, учившиеся только на ответах, показывают лучшие результаты, чем учившиеся только на вопросах, а учившиеся только на ответах. Это верно для всех рассмотренных базовых моделях, что доказывает: вопросы -- самый информативный элемент набора данных {RuQTopics}. 

Конкатенация вопросов к ответам не дает стойкого улучшения по сравнению с использованием только лишь вопросов. 

В общем и целом, все русскоязычные модели показывают похожие результаты, а многоязычная модель ожидаемо показывает результаты хуже, чем любая из русскоязычных. 

Все эти выводы также справедливы для экспериментов, в которых использовались все данные из части 1 набора данных {RuQTopics}, принадлежащие вышеупомянутым шести классам.

Для дальнейших экспериментов в этой главе был выбран режим предобработки \textbf{Q}, так как остальные режимы либо сложнее и при этом дают результаты не лучше, чем у \textbf{Q} (\textbf{Q [SEP] A}), либо показывают результаты хуже, чем у \textbf{Q} (\textbf{A}).

\section{Оценка для всех классов {RuQTopics}}

Другая важная задача -- определение того, как хорошо в принципе могут классы из {RuQTopics} быть различими. Для этого проводилась кросс-валидация по 5 разбиениям на тренировочную и валидационнную выборку на данных из всех 76 классов из однометочной части {RuQTopics}.\footnote{Для каждого из разбиений -- 80\% данных было тренировочными, 20\% валидационными и они же тестовыми, для разных разбиений это были разные 20\%.} Результаты представлены в Таблице~\ref{tab:crossvalidation}.


\begin{table*}
\centering
\caption{Метрики различных базовых моделей для 5-кратной кросс-валидации на всех классах из наборе данных {RuQTopics} при обучении только на вопросах.
 Базовые модели обозначаются как в Таблице~\ref{tab:rutopics:backbones}, Разб. означает разбиение, Точн. - точность, F1 - Макро-F1. Дисперсия не превосходит 0.65 для всех базовых моделей.}
\scalebox{0.8}{
\label{tab:crossvalidation}
\begin{tabular}{|c||c|c|c|c|c|c|c|c|c|c|c|c|}
\hline
\multirow{2}{*}{\textbf{Модель}} & \multicolumn{2}{c|}{\textbf{Среднее}} & \multicolumn{2}{c|}{\textbf{Разб. 1}} & \multicolumn{2}{c|}{\textbf{Разб. 2}} &\multicolumn{2}{c|}{\textbf{Разб. 3}} & \multicolumn{2}{c|}{\textbf{Разб. 4}} & \multicolumn{2}{c|}{\textbf{Разб. 5}} \\ 
\cline{2-13}
& Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 & Точн. & F1 \\ \hline
%\textit{rusber} & 74.0 & 53.4 \\ \hline
%\textit{ru} & 73.7 & 52.5 \\ \hline
%\textit{rutiny} & 72.2 & 50.9 \\ \hline
%\textit{mult} & 71.4 & 51.9 \\ \hline
\textit{rusber} & 74.0 & 53.4 & 73.7 & 54.3 & 73.8 & 52.8 & 73.9 & 53.0 & 74.1 & 54.2 & 74.2 & 52.9\\
\textit{ru} & 73.7 & 52.5 & 73.5 & 52.9 & 73.7 & 51.9 & 73.6 & 52.3 & 73.9 & 53.1 & 73.9 & 52.3\\
\textit{rutiny} & 72.2 & 50.9 & 72.0 & 49.7 & 72.2 & 50.9 & 72.0 & 51.4 & 72.4 & 51.1 & 72.3 & 51.6\\
\textit{mult} & 71.4 & 51.9 & 71.2 & 52.4 & 71.5 & 51.9 & 71.5 & 51.4 & 71.2 & 51.6 & 71.7 & 52.1\\ \hline
\end{tabular}
}
\end{table*}

Результаты могут быть дополнительно улучшены при помощи объединения некоторых классов из похожих тем «Яндекс. Кью». Но даже без этого, русскоязычные недистиллированные базовые модели  показывают точность 73.7-74.0\%, в то время как дистиллированные базовые модели показывают себя несколько хуже (точность 72.2\%). Многоязычная базовая модель ожидаемо показывает себя по этой метрике несколько хуже этих моделей (точность 71.4\%). Это показывает, что тематические классы в этом наборе данных можно отличить друг от друга с достаточно высокой точностью.

\section{Перенос знаний между языками}
После выбора наилучшего метода использования набора данных {RuQTopics}, необходимо было ответить на следующие вопросы:
\begin{itemize}
\item Как эффективно знания из {RuQTopics} переносятся между несколькими языками?
\item Что влияет на эффективность этого переноса?
\end{itemize}
Чтобы ответить на эти вопросы, были получены предсказания модели \textit{bert-base-multilingual-cased} не только для руссского языка, но и для всех языков из набора данных {MASSIVE}. Данная модель обучалась в режиме \textbf{Q} из Таблицы~\ref{tab:rutopics:matched}, на всех данных из шести выбранных в предыдущем разделе классов {RuQTopics}, имеющих только одну метку.

Для экспериментов использовалась версия 1.1 {MASSIVE}, содержащая каталанский язык. Так как {MASSIVE} и содержит как современную, так и традиционную версию китайской письменности, учитывались обе. Как и в Таблицах~\ref{tab:rutopics:matched} и~\ref{tab:rutopics:full}, полученные результаты были усреднены по трем запускам.\footnote{Для каждого из таких запусков различалась инициализация финального слоя модели.}
%To article -- точно work claims?
Полученные результаты представлены в Таблице~\ref{tab:rutopics:crosslingual}. Исходя из данной таблицы, можно сделать вывод о корреляции качества многоязычной модели BERT для разных языков с размером обучающей выборки для этих языков. Авторы модели \textit{bert-base-multilingual-cased} утверждают,\footnote{\url{https://github.com/google-research/bert/blob/master/multilingual.md}} что тренировочной выборкой модели \textit{bert-base-multilingual-cased} для каждого языка являлся размер Википедии для этого языка, при этом для обучающей выборки было применено экспоненциальное сглаживание со степенью 0.7 для балансировки языков.
%TO ARTICLE -- pretraining sample size. %Smoothing of training sample -- expressions as in the url.
Соответственно, в качестве приближения размера Википедии для каждого языка, был выбрано число статей Википедии для этого языка на 11 октября 2018 года (дату выпуска модели BERT), возведенное в степень 0.7.  Число статей Википедии для каждого языка на эту дату также представлено в Таблице~\ref{tab:rutopics:crosslingual}. Помимо этого, в Таблице~\ref{tab:rutopics:crosslingual} также представлена генеалогическая близость каждого языка к русскому, вычисленная в соответствии с работой~\cite{lang_sim}.

% TODO UPDATE ALL RUNS
\begin{table*}[!htbp]
\caption{Метрики модели \textit{bert-base-multilingual-cased} на объединенном тестовом наборе данных {MASSIVE} для всех языков. Модель обучалась на версии \textbf{Q} набора данных {RuQTopics}. \textbf{Код} означает код языка(ISO 639-1), \textbf{N} означает число статей в Википедии на этом языке на 11 октября 2018 года, \textbf{Дист} означает лингвистическую дистанцию между этим языком и русским, посчитанную в соответствии с работой~\cite{lang_sim}. Усреднено по трем запускам.}
\label{tab:rutopics:crosslingual}
% \centering
% \scalebox{0.7}{
\begin{minipage}{0.5\textwidth}
\scalebox{0.55}{
\begin{tabular}[baseline={(0,2.1)}]{|c|c|c|c|c|c|} \hline
\multirow{2}{*}{\textbf{Язык}}  & \multirow{2}{*}{\textbf{Код}} & \multirow{2}{*}{\textbf{Дист}} & \multirow{2}{*}{\textbf{N}}  &  \multicolumn{2}{c|}{\textbf{Метрики}} \\ %\hline
\cline{5-6}
& & & & Точность & Макро-F1 \\ \hline \hline
русский & ru & 0 & 1,501,878 & 80.8 & 79.8\\
китайский (Тайвань) & zh-TW & 92.2 & 1,025,366 & 79.6 & 79.1\\
китайский & zh & 92.2 & 1,025,366 & 78.0 & 77.7\\
английский & en & 60.3 & 5,731,625 & 75.2 & 75.6\\
японский & ja & 93.3 & 1,124,097 & 72.4 & 70.5\\
словенский & sl & 4.2 & 162,453 & 70.3 & 69.0\\
шведский & sv & 59.5 & 3,763,579 & 70.2 & 69.6\\
малайский & ms & n/c & 320,631 & 68.9 & 67.7\\
итальянский & it & 45.8 & 1,466,064 & 68.8 & 68.0\\
индонезийский & id & 91.2 & 440,952 & 68.7 & 67.5\\
нидерландский & nl & 64.6 & 1,944,129 & 68.7 & 68.5\\
португальский & pt & 61.6 & 1,007,323 & 68.6 & 68.7\\
испанский & es & 51.7 & 1,480,965 & 68.2 & 68.0\\
датский & da & 66.2 & 240,436 & 67.8 & 66.7\\
французский & fr & 61.0 & 2,046,793 & 65.5 & 65.5\\
персидский & fa & 72.4 & 643,750 & 65.2 & 64.2\\
турецкий & tr & 86.2 & 316,969 & 64.5 & 62.4\\
вьетнамский & vi & 95.0 & 1,190,187 & 64.3 & 65.1\\
норвежский букмол & nb & 67.2 & 495,395 & 64.3 & 64.0\\
польский & pl & 5.1 & 1,303,297 & 64.2 & 62.2\\
азербайджанский & az & 87.7 & 138,538 & 63.9 & 63.1\\
каталанский & ca & 60.3 & 591,783 & 61.4 & 60.4\\
венгерский & hu & 87.2 & 437,984 & 61.3 & 60.0\\
иврит & he & 88.9 & 231,868 & 60.9 & 59.5\\
хинди & hi & 69.8 & 127,044 & 60.7 & 58.7\\
корейский & ko & 89.5 & 429,369 & 60.4 & 59.6\\
\hline
\end{tabular}
}
\end{minipage}
\begin{minipage}{0.5\textwidth}
\scalebox{0.55}{
\begin{tabular}[baseline={(0,2.1)}]{|c|c|c|c|c|c|} \hline
\multirow{2}{*}{\textbf{Язык}}  & \multirow{2}{*}{\textbf{Код}} & \multirow{2}{*}{\textbf{Дист}} & \multirow{2}{*}{\textbf{N}}  &  \multicolumn{2}{c|}{\textbf{Метрики}} \\ %\hline
\cline{5-6}
& & & & Точность & Макро-F1 \\ \hline \hline
румынский & ro & 55.0 & 388,896 & 57.1 & 53.9\\
урду & ur & 66.7 & 140,939 & 56.4 & 55.9\\
арабский & ar & 86.5 & 619,692 & 56.2 & 55.7\\
каннада & kn & 90.8 & 23,844 & 56.1 & 53.0\\
филиппинский & tl & 91.9 & 80,992 & 55.0 & 51.3\\
телугу & te & 96.7 & 69,354 & 53.7 & 49.3\\
финский & fi & 88.9 & 445,606 & 53.3 & 51.3\\
бирманский & my & 86.0 & 39,823 & 52.5 & 49.7\\
африкаанс & af & 64.8 & 62,963 & 52.4 & 50.3\\
тамильский & ta & 94.7 & 118,119 & 52.4 & 50.1\\
немецкий & de & 64.5 & 2,227,483 & 52.2 & 51.6\\
албанский & sq & 69.4 & 74,871 & 51.5 & 47.2\\
латышский & lv & 49.1 & 88,189 & 49.6 & 48.4\\
малаялам & ml & 96.7 & 59,305 & 48.7 & 46.3\\
армянский & hy & 77.8 & 246,571 & 48.1 & 47.5\\
бенгальский & bn & 66.3 & 61,294 & 47.3 & 45.3\\
тайский & th & 89.5 & 127,010 & 46.5 & 44.9\\
греческий & el & 75.3 & 153,855 & 46.3 & 44.8\\
грузинский & ka & 96.0 & 124,694 & 39.2 & 38.1\\
яванский & jv & 95.4 & 54,964 & 38.7 & 37.1\\
монгольский & mn & 86.2 & 18,353 & 36.6 & 33.7\\
исландский & is & 68.9 & 45,873 & 32.6 & 29.9\\
суахили & sw & 95.1 & 45,806 & 31.0 & 28.0\\
валлийский & cy & 75.5 & 101,472 & 28.5 & 25.3\\
кхмерский & km & 97.1 & 6,741 & 16.1 & 8.6\\
амхарский & am & 86.6 & 14,375 & 12.1 & 5.0\\ \hline
\hline
\end{tabular}
}
\end{minipage}
\end{table*}

%TODO p-value p-значение
Корреляция Спирмена точности для каждого языка с экспоненциально сглаженным размером Википедии равняется 0.773 (p-значение 5.02e-10). При этом корреляция точности с генеалогической дистанцией до русского равна -0.323 (p-значение 0.022). Если же учесть при подсчете этой корреляции экспоненциально сглаженный размер Википедии как третью переменную, то частичная корреляция точности с генеалогической дистанцией до русского языка становится равной -0.151 с пи-значением 0.3, что не является статистически значимым.

Заметим(см. Таблицу~\ref{tab:rutopics_crosslingual_frozenbody}), что не только для русского языка, но и практически для всех языков набора данных MASSIVE дообучение тела модели увеличивает результаты модели. Исключением является амхарский язык, для которого многоязычный BERT при любых экспериментах показал себя на очень низком уровне - вероятно, в связи с отсутствием предобучающей выборки достаточного размера. Данный вывод был получен при проведении экспериментов из Таблицы~\ref{tab:rutopics:crosslingual} с замороженным телом модели (обучением только финальных линейных слоёв).

Таким образом, в экспериментах из Таблицы~\ref{tab:rutopics:crosslingual} перенос знаний производился в том числе при помощи дообучения тела модели на много языков.

\begin{table*}
\centering
\caption{Сравнение метрик в экспериментах из Таблицы~\ref{tab:rutopics:crosslingual} с дообучением тела модели(т.е как в Таблице~\ref{tab:rutopics:crosslingual}) и без дообучения тела модели(с обучением только финальных линейных слоев). Усреднено по трем запускам.}
\scalebox{0.5}{
\label{tab:rutopics_crosslingual_frozenbody}
\begin{tabular}{|c|c|c|c|c|c||c|c|c|c|c|c|}
\hline

\multirow{2}{*}{\textbf{Язык}}  & \multirow{2}{*}{\textbf{Код}} & \multicolumn{2}{c|}{\textbf{Без дообучения}} & \multicolumn{2}{c||}{\textbf{С дообучением}} & \multirow{2}{*}{\textbf{Язык}}  & \multirow{2}{*}{\textbf{Код}} & \multicolumn{2}{c|}{\textbf{Без дообучения}} & \multicolumn{2}{c|}{\textbf{С дообучением}} \\ %\hline
\cline{3-6}
\cline{9-12}
& & Точность & Макро-F1 & Точность & Макро-F1 & & & Точность & Макро-F1 & Точность & Макро-F1 \\ \hline \hline
английский & en & 64.0 & 61.0 & 75.2 & 75.6 & албанский & sq & 43.3 & 40.4 & 51.5 & 47.2\\
русский & ru & 56.4 & 54.1 & 80.8 & 79.8 & персидский & fa & 42.4 & 40.7 & 65.2 & 64.2\\
французский & fr & 54.6 & 51.6 & 65.5 & 65.5 & иврит & he & 40.9 & 36.9 & 60.9 & 59.5\\
итальянский & it & 53.9 & 50.3 & 68.8 & 68.0 & арабский & ar & 40.8 & 37.2 & 56.2 & 55.7\\
нидерландский & nl & 50.8 & 47.9 & 68.7 & 68.5 & азербайджанский & az & 38.8 & 36.6 & 63.9 & 63.1\\
китайский & zh & 50.8 & 49.2 & 78.0 & 77.7 & немецкий & de & 38.6 & 37.2 & 52.2 & 51.6\\
испанский & es & 50.5 & 48.2 & 68.2 & 68.0 & тамильский & ta & 37.9 & 34.7 & 52.4 & 50.1\\
каталанский & ca & 50.3 & 46.3 & 61.4 & 60.4 & африкаанс & af & 37.6 & 36.3 & 52.4 & 50.3\\
португальский & pt & 49.8 & 48.2 & 68.6 & 68.7 & урду & ur & 37.3 & 35.4 & 56.4 & 55.9\\
малайский & ms & 49.1 & 46.1 & 68.9 & 67.7 & финский & fi & 37.3 & 35.7 & 53.3 & 51.3\\
турецкий & tr & 49.0 & 46.0 & 64.5 & 62.4 & венгерский & hu & 37.1 & 36.5 & 61.3 & 60.0\\
китайский (Тайвань) & zh-TW & 48.6 & 47.1 & 79.6 & 79.1 & малаялам & ml & 36.5 & 34.4 & 48.7 & 46.3\\
индонезийский & id & 48.4 & 45.7 & 68.7 & 67.5 & тайский & th & 33.1 & 29.7 & 46.5 & 44.9\\
польский & pl & 47.8 & 43.6 & 64.2 & 62.2 & латышский & lv & 31.6 & 29.3 & 49.6 & 48.4\\
шведский & sv & 47.7 & 45.3 & 70.2 & 69.6 & греческий & el & 30.1 & 28.5 & 46.3 & 44.8\\
словенский & sl & 47.6 & 42.9 & 70.3 & 69.0 & бирманский & my & 30.0 & 27.7 & 52.5 & 49.7\\
вьетнамский & vi & 47.2 & 46.6 & 64.3 & 65.1 & яванский & jv & 28.1 & 25.1 & 38.7 & 37.1\\
каннада & kn & 46.3 & 43.2 & 56.1 & 53.0 & бенгальский & bn & 27.4 & 25.8 & 47.3 & 45.3\\
японский & ja & 46.3 & 44.6 & 72.4 & 70.5 & грузинский & ka & 27.4 & 23.7 & 39.2 & 38.1\\
норвежский букмол & nb & 45.2 & 42.5 & 64.3 & 64.0 & армянский & hy & 27.2 & 26.3 & 48.1 & 47.5\\
филиппинский & tl & 44.9 & 42.4 & 55.0 & 51.3 & валлийский & cy & 26.8 & 23.8 & 28.5 & 25.3\\
датский & da & 44.8 & 42.1 & 67.8 & 66.7 & монгольский & mn & 23.7 & 19.5 & 36.6 & 33.7\\
корейский & ko & 44.7 & 43.7 & 60.4 & 59.6 & исландский & is & 22.4 & 19.1 & 32.6 & 29.9\\
хинди & hi & 44.4 & 41.7 & 60.7 & 58.7 & амхарский & am & 20.7 & 9.1 & 12.1 & 5.0\\ 
телугу & te & 43.7 & 40.2 & 53.7 & 49.3 & суахили & sw & 19.1 & 15.9 & 31.0 & 28.0\\
румынский & ro & 43.6 & 40.9 & 57.1 & 53.9 & кхмерский & km & 11.1 & 6.6 & 16.1 & 8.6\\
\hline
\end{tabular}
}
\end{table*}

\section{Выводы и анализ результатов} 

В данной главе изучается составленный автором русскоязычный набор данных для разговорной тематической классификации -- {RuQTopics}. Этот тематический набор данных объединяет большое количество примеров (361560 -- принадлежащих одному классу, 170930 -- 2 классам и более) с обширным охватом классов (76 классов). Этот набор данных сгруппирован по темам из «Яндекс.Кью»; для каждого вопроса приводится суммаризованный вариант ответа, ссылка на полный ответ и темы вопросов и ответов в «Яндекс.Кью».

Как можно видеть, набор данных {RuQTopics} подходит достаточно хорошо для разговорной тематической классификации. Так, для классификации вопросов, русскоязычные модели типа BERT, обученные на шестиклассовой подвыборке {RuQTopics}, показывают точность около 85.0\% на подвыборке соответствующих 6 классов из русскоязычного {MASSIVE} (Таблица~\ref{tab:rutopics:full}).

Можно сделать предположение, что набор данных {RuQTopics} подходит также для вопросно-ответной классификации, однако проверка этого предположения требует дополнительных исследований.

Для обучения моделей на вопросах из всех 76 классах {RuQTopics}, все базовые модели показывают точность выше 70\%. Это показывает, что тематические классы в данном наборе данных достаточно хорошо различимы.
Русскоязычные модели показывают данные результаты, только если вопросы из  {RuQTopics} используются в тренировочных примерах (сами по себе или в конкатенации с ответами/суммаризованными ответами). Это доказывает, что вопросы -- самая информативная часть данного набора данных.

В общем случае, данные результаты показывают важность размеченных коротких примеров в тематических наборах данных. 

На удивление, результаты на наборе данных {MASSIVE} практически не меняются для различных русскоязычных базовых моделей. Это показывает, что дистиллированные модели хорошо подходят для разговорных задач, особенно в условиях ограниченных вычислительных ресурсов.

При обучении моделей на всех 76 классах из {RuQTopics} и использовании в примерах только вопросов, все базовые модели показывают точность выше 70 процентов, несмотря на схожесть некоторых классов в данном наборе данных. Это показывает, что набор данных {RuQTopics} подходит для решения задачи классификации целиком, а не только своими шестью классами.

Также в данной главе показано, что в случае оценки модели  \textit{bert-base-multilingual-cased}, обученной на шестиклассовой подвыборке вопросов из {RuQTopics}, на подвыборке соответствующих 6 классов из {MASSIVE} для всех 51 поддерживаемых в {MASSIVE} языков, точность для каждого языка сильно коррелирует с аппроксимированном набором обучающей выборки для этого языка (корреляция Спирмена 0.773 c p-значением 2.997e-11). Размер обучающей выборки был аппроксимирован при помощи возведения числа статей в Википедии для каждого языка на 11 октября 2018 года (дата выпуска статьи \cite{bert}) в степень 0.7, по аналогии с оригинальной статьей. 
%TODO -- Спирмен, пи-значение, как пишется?

Данная корреляция была получена даже несмотря на то, что средняя статья в Википедии на разных языках имеет разное число токенов и предложений. Это приводит к предположению о том, что если бы для каждого языка имелось в явном виде число тренировочных примеров, которое модель \textit{bert-base-multilingual-cased} получала на этапе предобучения, корреляция была бы еще выше -- но авторы оригинальной статьи не предоставили ни оригинальную обучающую выборку, ни её размер по языкам. 

При этом корреляция результатов модели на том или ином языке с генеалогическим расстоянием между этим языком и русским не является статистически значимой. Это приводит к выводу, что основной фактор, определяющий качество переноса знаний между языками в многоязычных моделях типа BERT -- это размер выборки на предобучении для этого языка.\footnote{Вероятно, для языков, которые являются очень лингвистически близкими, лингвистическая близость также влияет на качество переноса знаний, но оценка этого фактора требует дополнительных исследований.} С учетом выводов Главы~\ref{ch:tr-ag}, данный вывод может быть расширен и на многозадачные модели.

Отдельно также можно отметить, что дообучение тела многоязычной модели типа BERT способствует переносу знаний практически для всех рассмотренных языков. Исключением является амхарский язык, для которого размер предобучающей выборки был недостаточен.

Главный \textbf{вывод} из этой главы -- \textbf{для многоязычных нейросетевых моделей качество переноса знаний на разные языки на тематических данных сильно коррелирует с размером предобучающей выборки для каждого языка, но при этом статистически значимая корреляция с генеалогической близостью этого языка к языку дообучения не обнаруживается.}
%\begin{enumerate}
%\item \textbf{Русскоязычный открытый набор тематических данных {RuQTopics} пригоден для решения задачи русскоязычной тематической классификации и фундаментальных задач исследования переноса знаний.}
%\item \textbf{Для многоязычных нейросетевых моделей качество переноса знаний на разные языки на тематических данных сильно коррелирует с размером предобучающей выборки для каждого языка, но при этом не коррелирует с генеалогической близостью этого языка к языку дообучения.}
%\end{enumerate}


 
